<html>

<head>
  <script type="module" src="node_modules/mobile-hybrid-sdk/lib/javascript/dist/main.js"></script>
  <style>
    iframe {
      border: 1 px solid #efefef;
      border-radius: 8px;
      width: 1200px;
      height: 500px;
    }
  </style>
</head>

<body>
  <h1></h1>
  <iframe id="myiframe" frameborder="0"></iframe>
  <script type="module">
    const config = {
      callbackUrl: "http://localhost:5000/main.html",
      clientId:
        "3MVG9CEn_O3jvv0x_GqVPvcLpo7KO.USvG5g9_oPpSd7ZQLY_p.aa.5hioTv9rPljrTYmryejDVHjNIKdGrAv",
      clientSecret:
        "C538CF52EDF142F10A435A17A63677BC9E9F62F7A28C5AA32DFFE1D20F389D7D",
      authUrl: "https://login.salesforce.com/services/oauth2/authorize",
      apiVersion: "v45.0",
      responseType: "token",
    };
    const sf = new Salesforce(config);
    const h1 = document.querySelector("h1");
    const iframe = document.querySelector("iframe");

    (async () => {
      const { user } = await sf.init(window.location.href);

      h1.textContent = `${user.FirstName} ${user.LastName}`;
      iframe.src = sf.frontDoor(
        sf.lwcUri({
          iframeId: "myiframe",
          // componentName: 'showAlertButton',
          componentName: "testDoneEnglish",
          // componentName: "cfCardDemoTwo",
          refs: ["c-omni-button", "c-card-demo-two-layout"],
          methods: ["getEmail", "getData", "greeter"],
        })
      );
    })();

    const handler = (event) => {
      console.log(event);
      if (event.data && event.data.name === "mobileaction") {
        return iframe.contentWindow.postMessage(
          {
            type: "setelementprops",
            target: [
              {
                element: "c-omni-button .input",
                props: {
                  // email: "hello_from_client_code@email.com",
                  value: 'test'
                },
              },
            ],
          },
          "*"
        );
      }

      if (event.data && event.data.name === "getEmail") {
        iframe.contentWindow.postMessage(
          {
            callId: event.data.callId,
            type: "callback",
            response: "iframe@data.com",
          },
          "*"
        );
      }

      if (event.data && event.data.name === "getData") {
        iframe.contentWindow.postMessage(
          {
            callId: event.data.callId,
            type: "callback",
            response: `Hello ${event.data.args[0]}, from native code!`,
          },
          "*"
        );
      }

      if (event.data && event.data.name === "greeter") {
        iframe.contentWindow.postMessage(
          {
            callId: event.data.callId,
            type: "setprops",
            props: {
              greeter: 'Hello'
            }
          },
          "*"
        );
      }
    };

    window.addEventListener("message", handler, true);
  </script>
</body>

</html>